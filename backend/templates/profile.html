<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Profile â€¢ AI-Enhanced Survey</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
	<nav class="navbar navbar-light bg-white shadow-sm mb-3">
		<div class="container">
			<a class="navbar-brand" href="/">AI-Enhanced Survey</a>
			<div class="d-flex align-items-center">
				{% if current_user.is_authenticated %}
					{% if current_user.profile_image %}
						<img src="{{ current_user.profile_image }}" class="rounded-circle me-2" style="width:28px;height:28px;object-fit:cover;" alt="avatar"/>
					{% endif %}
					<span class="badge bg-light text-dark me-2"><i class="fas fa-user me-1"></i>{{ current_user.username }}</span>
				{% endif %}
				<a class="btn btn-outline-secondary btn-sm" href="/">Back</a>
				<a class="btn btn-warning btn-sm ms-2" href="/logout">Logout</a>
			</div>
		</div>
	</nav>
	<div class="container" style="max-width:720px">
		<div class="card shadow-sm" style="border-radius:16px;">
			<div class="card-body">
				<h4 class="mb-3">Edit profile</h4>
				{% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
				{% if success %}<div class="alert alert-success">{{ success }}</div>{% endif %}
				<form method="POST" action="/profile" enctype="multipart/form-data">
					<div class="mb-3 text-center">
						{% if user.profile_image %}
							<img id="avatarPreview" src="{{ user.profile_image }}" alt="avatar" class="rounded-circle mb-2" style="width:96px;height:96px;object-fit:cover;"/>
						{% else %}
							<div class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-2" style="width:96px;height:96px;" id="avatarPreviewPlaceholder">
								<i class="fas fa-user text-secondary"></i>
							</div>
						{% endif %}
						<div>
							<label class="form-label">Profile picture</label>
							<input class="form-control" type="file" name="avatar" accept="image/*" onchange="previewAvatar(event)" />
						</div>
					</div>
					<div class="mb-3">
						<label class="form-label">Username</label>
						<input class="form-control" name="username" value="{{ user.username }}" required />
					</div>
					<div class="mb-3">
						<label class="form-label">Email</label>
						<input class="form-control" name="email" type="email" value="{{ user.email or '' }}" />
					</div>
					<div class="mb-3">
						<label class="form-label">New password (optional)</label>
						<input class="form-control" name="password" type="password" placeholder="Leave blank to keep current" />
					</div>
					<button class="btn btn-primary">Save changes</button>
				</form>
			</div>
		</div>
	</div>
<script>
function previewAvatar(e){
    const file = e.target.files && e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(ev){
        let img = document.getElementById('avatarPreview');
        const placeholder = document.getElementById('avatarPreviewPlaceholder');
        if(!img){
            img = document.createElement('img');
            img.id = 'avatarPreview';
            img.className = 'rounded-circle mb-2';
            img.style.width = '96px';
            img.style.height = '96px';
            img.style.objectFit = 'cover';
            placeholder && placeholder.replaceWith(img);
        }
        img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
}
</script>
</body>
</html>


